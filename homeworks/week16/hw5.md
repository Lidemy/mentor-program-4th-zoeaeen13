## é€™é€±å­¸äº†ä¸€å¤§å †ä»¥å‰æä¸æ‡‚çš„æ±è¥¿ï¼Œä½ æœ‰è®Šå¾—æ›´æ‡‚äº†å—ï¼Ÿè«‹å¯«ä¸‹ä½ çš„å¿ƒå¾—ã€‚
é€™ç¯‡ç­†è¨˜æ¯”è¼ƒå¤šï¼Œå¯é»é€£çµç›´æ¥æ‰¾åˆ°ï¼š

* [èªè­˜ JS çš„è®Šæ•¸](#èªè­˜-js-çš„è®Šæ•¸)
* [ä¾†è«‡è«‡ Event Loop](#ä¾†è«‡è«‡-event-loop)
* [Scope ä½œç”¨åŸŸ](#scope-ä½œç”¨åŸŸ)
* [Hoisting æå‡](#hoisting-æå‡)
* [ç‰©ä»¶å°å‘èˆ‡åŸå‹éŠ](#ç‰©ä»¶å°å‘)
* [this](#this)

## èªè­˜ JS çš„è®Šæ•¸
ä¾ç…§èªè¨€çš„å‹åˆ¥ç³»çµ±ï¼ˆType systemï¼‰ä¾†åˆ†æˆã€Œå¼·å‹åˆ¥èªè¨€ã€èˆ‡ã€Œå¼±å‹åˆ¥èªè¨€ã€å…©ç¨®ï¼š
* å¼·å‹åˆ¥ï¼šè®Šæ•¸åœ¨è¢«å®£å‘Šçš„æ™‚å€™ï¼Œå¿…é ˆæŒ‡å®šä¸€ç¨®è³‡æ–™å‹åˆ¥çµ¦å®ƒï¼Œå¯ä»¥åˆ©ç”¨ç·¨è­¯å™¨æå‰åšå‹åˆ¥æª¢æŸ¥ï¼Œæ¸›å°‘åœ¨åŸ·è¡Œæ™‚æœŸï¼ˆRuntimeï¼‰ç™¼ç”Ÿçš„éŒ¯èª¤
* å¼±å‹åˆ¥ï¼šèªæ³•ç°¡æ½”ï¼Œä½†è¦æ³¨æ„å‹æ…‹è½‰æ›æ™‚çš„å•é¡Œ

**è®Šæ•¸æ²’æœ‰å‹åˆ¥ï¼Œå€¼æ‰æœ‰**
JavaScript å‹åˆ¥çš„è³‡è¨Šåªåœ¨å€¼æˆ–ç‰©ä»¶æœ¬èº«ï¼Œè®Šæ•¸åªç”¨ä¾†ä½œç‚ºå–å¾—å€¼æˆ–ç‰©ä»¶çš„åƒè€ƒã€‚å‹æ…‹ä¸»è¦æœ‰å…©ç¨®ï¼Œåˆ†æˆ Primitive type åŸºæœ¬å‹åˆ¥å’Œ Object types ç‰©ä»¶å‹åˆ¥
#### ä¸€ã€Primitive type åŸºæœ¬å‹åˆ¥
å…§å»ºå‹åˆ¥ï¼ˆBuilt-in Typesï¼‰ï¼Œåªæ˜¯ä¸€å€‹å€¼ã€ä¸¦ä¸æ˜¯ç‰©ä»¶ï¼ˆç‰©ä»¶æ˜¯åç¨± + å€¼çš„çµ„åˆï¼‰ï¼ŒPrimitive å…·æœ‰ä¸å¯è®Šçš„ç‰¹æ€§ï¼Œåˆ†ç‚ºä»¥ä¸‹å¹¾ç¨®

| å‹åˆ¥ | åç¨± | ç”¨æ„ |
| -------- | -------- | -------- |
| undefined | é‚„ä¸å­˜åœ¨ | é€™æ˜¯ JavaScript çµ¦æ‰€æœ‰è®Šæ•¸çš„åˆå§‹å€¼ï¼Œé‚„æ²’è®Šæ•¸å®šç¾© |
| null | å…¶æ±è¥¿ä¸å­˜åœ¨ | æŒ‡ä¸€å€‹ä¸å­˜åœ¨çš„æˆ–ç„¡æ•ˆçš„ç‰©ä»¶ï¼ˆobjectï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ nullï¼Œä¸æ˜¯ä½¿ç”¨ undefined |
| Boolean  | å¸ƒæ—å€¼ | true å’Œ false å…¶ä¸­ä¸€å€‹å¯èƒ½ |
| Number | æ•¸å­—å‹åˆ¥ | JS åªæœ‰ä¸€ç¨®æ•¸å€¼å‹æ…‹ï¼Œå°±æ˜¯ numberï¼Œé™¤äº†æ•´æ•¸å’Œå°æ•¸å­—å¤–ï¼Œç‰¹æ®Šæ•¸å­—æœ‰ Infinityï¼ˆç„¡é™å¤§ï¼‰ã€ -Infinityï¼ˆè² ç„¡é™å¤§ï¼‰ï¼Œä»¥åŠ NaNï¼ˆä¸æ˜¯æ•¸å€¼ï¼ŒNot a Numberï¼‰ |
| String | å­—ä¸² | ä»£è¡¨æ–‡å­—è³‡æ–™ |
| symbol |ç¬¦è™Ÿ | è¢«ä½¿ç”¨åœ¨ ES6 æˆ– ECMAScript 6ï¼Œé‚„åœ¨å»ºé€ ä¸­ï¼Œæ²’è¢«å…¨éƒ¨ç€è¦½å™¨æ”¯æ´ |



#### Object types
ç‰©ä»¶å‹åˆ¥ï¼Œç‰©ä»¶èˆ‡å…¶å­å‹åˆ¥ï¼ˆsubtypeï¼‰ï¼Œä¾‹å¦‚ï¼šç‰©ä»¶ã€é™£åˆ—ã€å‡½å¼ç­‰ç­‰ï¼Œç‰©ä»¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€å€‹ç”¨ä¾†è£æ•¸å€¼çš„å®¹å™¨ï¼š
* Object ç‰©ä»¶
* Array é™£åˆ—
* Function å‡½å¼

Array ä½¿ç”¨æ•¸å€¼åŒ–ã€Œç´¢å¼•ã€ä¾†å„²å­˜å€¼ï¼Œè€Œéå¦‚ Object æ˜¯ä½¿ç”¨å±¬æ€§ä¾†å„²å­˜å€¼ã€‚Function å‡½å¼æ˜¯æŒ‡ä¸€æ®µç¨‹å¼ç¢¼ç‰‡æ®µï¼Œå¯è—‰ç”±å‘¼å«å…¶åç¨±ä¾†åŸ·è¡Œå®ƒï¼Œå¯ç°¡åŒ–é‡è¤‡é€²è¡Œçš„å·¥ä½œã€åŒ…è£ç‰¹å®šåŠŸèƒ½çš„ç¨‹å¼ç¢¼ã€‚

#### Primitive type å’Œ Object type å¤§ä¸åŒ
:::danger
##### 1. Immutable ç‰¹æ€§
åœ¨ Primitive Type å®ƒæ˜¯æœƒå›å‚³ä¸€å€‹æ–°çš„ï¼Œè€Œä¸æ˜¯æ”¹è®Šå®ƒè‡ªå·±ï¼Œåœ¨å° String åšæ“ä½œçš„æ™‚å€™è¦ç‰¹åˆ¥æ³¨æ„é€™äº›å…§å»ºå‡½å¼
```javascript=
var str = 'hello';
str.toUpperCase();   
console.log(str);    // hello

var arr = [1];
arr.push(2);
console.log(arr);    // [1, 2]
```

##### 2. è³¦å€¼çš„é™·é˜±
Primitive Type å­˜çš„æ˜¯å€¼ï¼ŒObject æœƒå…ˆçµ¦å®šä¸€è¨˜æ†¶é«”ä½ç½®ï¼Œå†å»è®€å–è£¡é¢çš„å€¼
```javascript=
var obj = {
    number: 10,
};

var obj2 = obj;
console.log(obj, obj2);  // 10, 10

obj2.number = 20
console.log(obj, obj2)   // 20, 20
```
è¦ææ¸…æ¥šé‡æ–°è³¦å€¼ï¼ˆ=ï¼‰å’Œ . çš„å·®åˆ¥
```javascript=
var obj = {
    number: 10,
};

var obj2 = obj;
console.log(obj, obj2);  // 10, 10

// å…ˆçµ¦ [30] ä¸€å€‹ä½ç½®ï¼Œå†æŠŠ obj2 æ›æ‰è¨˜æ†¶é«”ä½ç½®ï¼Œæ‰€ä»¥å…©è€…æŒ‡çš„æ˜¯ä¸åŒçš„ä½ç½®
obj2 = [30]
console.log(obj, obj2)   // 10, 30
```
:::


#### è³‡æ–™å‹åˆ¥è½‰æ›
å¯ä»¥ä½¿ç”¨ `typeof` ä¾†æª¢æ¸¬å€¼çš„è³‡æ–™å‹åˆ¥ç‚ºä½•
```javascript=
typeof 'Hello World!'; // 'string'
typeof true; // 'boolean'
typeof 1234567; // 'number'
typeof null; // 'object'
typeof undefined; // 'undefined'
typeof { name: 'Jack' }; // 'object'
typeof Symbol(); // 'symbol'
typeof function() {}; // 'function'
typeof [1, 2, 3]; // 'object'
typeof NaN; // 'number'
```
#### æ›´å¤š typeof ä½¿ç”¨æƒ…å¢ƒï¼Ÿ
æœ‰æ™‚å€™æœƒè¢«æ‹¿ä¾†æª¢æŸ¥ï¼šè®Šæ•¸æœ‰æ²’æœ‰è¢«ä½¿ç”¨åˆ°
```javascript=
if (typeof a !== 'undefined') {
    console.log(a);
}
```

#### Q: null ç‚ºä»€éº¼æ˜¯ objectï¼Ÿå®ƒæ˜¯åŸºæœ¬å‹åˆ¥å—ï¼Ÿ
null æ˜¯åŸºæœ¬å‹åˆ¥ä¹‹ä¸€ï¼Œä½† typeof null å»å¾—åˆ° objectï¼Œè€Œé nullï¼é€™å¯èªªæ˜¯ä¸€å€‹ bug
```javascript=
typeof null         // object (bug in ECMAScript, should be null)
typeof undefined    // undefined
null === undefined  // false  ( === æœƒåˆ¤æ–·é¡å‹)
null == undefined   // true   ( == æœƒåŸ·è¡Œé¡å‹è½‰æ›)
```
#### Q: function æ˜¯ç‰©ä»¶çš„å­å‹åˆ¥ï¼Œä½† typeof function() {} æ˜¯å¾—åˆ° function è€Œé objectï¼Ÿ
å’Œé™£åˆ—ä¾èˆŠå¾—åˆ° object ä¸ä¸€æ¨£ï¼Œåœ¨ JavaScript è¦ºå¾— function å¤ªç‰¹åˆ¥äº†ï¼Œæ‰€ä»¥å¦å¤–çµ¦å®ƒç¨æœ‰çš„å›å‚³å€¼

#### Q: NaN è¡¨ç¤ºæ˜¯ç„¡æ•ˆçš„æ•¸å­—ï¼Œä½†ä¾èˆŠé‚„æ˜¯ numberï¼Ÿ
NaN åœ¨ JavaScript ç•¶ä¸­æ˜¯å€‹æœ‰è¶£çš„å­˜åœ¨ï¼Œå­—é¢ä¸Šä¾†èªªå®ƒä¸æ˜¯å€‹æ•¸å­—ï¼Œä½†ä½ è‹¥ç”¨ typeof é‹ç®—å­ä¾†åˆ¤æ–·å‹æ…‹ï¼Œå®ƒåˆæœƒå‘Šè¨´ä½ é€™æ˜¯å€‹ numberã€‚

ä¸è¦è¢«å­—é¢ä¸Šçš„æ„æ€ã€Œä¸æ˜¯æ•¸å­—ã€ï¼ˆnot a numberï¼‰çµ¦å¼„ç³Šå¡—äº†ï¼Œå®ƒä¾ç„¶æ˜¯æ•¸å­—ã€‚å¦å¤– NaN èˆ‡ä»»ä½•æ•¸å­—é‹ç®—éƒ½æœƒå¾—åˆ° NaNï¼Œä¸¦ä¸” NaN ä¸å¤§æ–¼ã€ä¸å°æ–¼ä¹Ÿä¸ç­‰æ–¼ä»»ä½•æ•¸å­—ï¼ŒåŒ…å« NaN å®ƒè‡ªå·±ã€‚

```javascript=
var a = Number('hello');  // æ²’è¾¦æ³•è½‰ï¼Œæœƒè®Šæˆ NaN
console.log(a === a)      // NaN
console.log(isNaN(a))     // trueï¼Œå¯ä»¥ç”¨ isNaN() æ–¹æ³•ä¾†æª¢æ¸¬
```

#### Q: åˆ°åº• undefined å’Œ not defined å·®åœ¨å“ªï¼Ÿ
åœ¨ console æ™‚å¶çˆ¾æœƒé‡åˆ°é€™å…©ç¨®å€¼ï¼Œå®Œå…¨æ˜¯ä¸åŒçš„æ„ç¾©
* undefined â†’ æœ‰å®£å‘Šé€™å€‹è®Šæ•¸ï¼Œä½†æ²’æœ‰å®šç¾©æ‰€ä»¥æ²’æœ‰è¨­å®šå€¼
* not defined â†’ ç„¡æ³•åƒç…§ï¼Œä»£è¡¨éŒ¯èª¤ï¼Œæ²’æœ‰é€™å€‹è®Šæ•¸å­˜åœ¨

#### Q: å…¶ä»–çš„æª¢æ¸¬æ–¹å¼ï¼Ÿ
```javascript=
object.prototype.toString.call(è¦æª¢æ¸¬çš„æ±è¥¿)
```
* æª¢æ¸¬ç¶²ç«™ï¼šhttps://dorey.github.io/JavaScript-Equality-Table/

#### Q: ç‚ºä»€éº¼æ°¸é éƒ½ç”¨ === ï¼Ÿ
å› ç‚º `==` æœƒæ¶‰åŠå‹æ…‹è½‰æ›ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼å°±æ˜¯éƒ½ç”¨ `===`

è€Œ `===` æ°¸é åªæœ‰åœ¨å…©è€…**æŒ‡å‘åŒä¸€å€‹è¨˜æ†¶é«”ä½ç½®**æ™‚æ‰æœƒæˆç«‹ï¼Œå®ƒä¸¦ä¸æ˜¯åœ¨æ¯”è¼ƒå…©å€‹çš„å€¼ï¼Œæ˜¯æ¯”è¼ƒä»–å€‘çš„ä½ç½®ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ `console.loe([] === [])` æœƒæ˜¯ **FALSE** çš„åŸå› ï¼Œå› ç‚ºä»–å€‘å¯¦éš›ä¸Šæ˜¯å­˜åˆ°ä¸åŒçš„è¨˜æ†¶é«”ä½ç½®


---
## ä¾†è«‡è«‡ Event Loop
é€™å€‹éƒ¨åˆ†ï¼Œå°‡é€éè§£é‡‹ Event Loop æ©Ÿåˆ¶é †ä¾¿ç†è§£ä»¥ä¸‹å¸¸è¦‹çš„åè©
```
Single Thread å–®åŸ·è¡Œç·’
Call stack å‘¼å«å †ç–Š
Blocking é˜»å¡
Event loop äº‹ä»¶å¾ªç’°
Callback å›èª¿
Callback Queue å›èª¿åºåˆ—
```
### Call Stack åŸ·è¡Œå †ç–Š
JS æ˜¯ä¸€å€‹å–®åŸ·è¡Œç·’çš„èªè¨€ï¼Œæœ‰ä¸€å€‹å–®åŸ·è¡Œç·’çš„ Runtimeï¼ˆåŸ·è¡Œç’°å¢ƒç³»çµ±ï¼‰ï¼ŒåŸ·è¡Œç·’å¯ä»¥æƒ³åƒæˆåŸ·è¡Œå·¥ä½œçš„å–®ä½ï¼Œå–®åŸ·è¡Œç·’æ„å‘³è‘—å®ƒä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹ã€‚åœ¨ç¨‹å¼ç¢¼é‹è¡Œå‰ï¼ŒJS çš„ Runtimeï¼ˆè¨˜æ†¶é«”å †ç–Šã€é»˜èªåŸ·è¡Œç’°å¢ƒã€åŸ·è¡Œç’°å¢ƒå †ç–Šï¼‰æœƒè¢«å»ºç«‹ã€‚

ä¹‹å¾Œä¾åºåŸ·è¡Œï¼Œä¸€æ—¦å‘¼å«åˆ°å…¶ä»–å‡½å¼ï¼ŒGlobal EC æœƒå¹«å‘¼å«åˆ°çš„å‡½å¼ç”¢ç”Ÿæ–°çš„ Execution Context æ”¾åˆ° stack ä¸Šï¼Œç•¶å¤šå€‹å‡½ç¤ºè¢«å‘¼å«å°±æœƒç”¢ç”Ÿå¤šå€‹ ECï¼Œä¾åºå †ç–Šä¸Šå»ï¼Œé€™è¢«ç¨±ç‚ºåŸ·è¡Œå †ç–Šï¼ˆcall stackï¼‰ã€‚

call stack çš„ç‰¹æ€§æ˜¯å¾Œé€²å…ˆå‡ºï¼Œæœ€å¾Œè¢«å †ä¸Šå»çš„ EC æœƒä½œç‚ºç›®å‰çš„åŸ·è¡Œç’°å¢ƒå…ˆè¢«åŸ·è¡Œï¼Œå› ç‚ºå–®åŸ·è¡Œç·’çš„ç‰¹æ€§ï¼Œä¸€æ¬¡åªæœƒåŸ·è¡Œä¸€å€‹ç¨‹å¼ç¢¼ç‰‡æ®µï¼Œè¦ç­‰åˆ°è©²å‡½å¼åŸ·è¡Œå®Œç•¢ reurn å¾Œï¼Œå®ƒçš„ EC æ‰æœƒè‡ªå‹•å¾åŸ·è¡Œå †ç–Šçš„é ‚ç«¯æŠ½æ‰ï¼ˆpop offï¼‰ï¼Œå†åŸ·è¡Œåº•ä¸‹ä¸€å±¤çš„ç¨‹å¼ç¢¼ã€‚

![](https://i.imgur.com/t0xDDE2.png)



#### Q: ç‚ºä»€éº¼ä¸èƒ½åœ¨ä¸€å€‹å‡½å¼å‘¼å«å®ƒè‡ªå·±ï¼Ÿ
ç„¡çª®è¿´åœˆï¼Œæœƒé€ æˆå †ç–Šçˆ†ç‚¸ï¼ˆStack Overflowï¼‰
```javascript=
function foo() {
    return foo();
}

foo();
```

### Blocking é˜»å¡
ç„¶è€Œï¼Œæœ‰äº›æ±è¥¿å°±æ˜¯è·‘ç‰¹åˆ¥æ…¢ï¼Œéœ€è¦ç­‰å¾…å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼Œæ¯”å¦‚ç¶²è·¯è«‹æ±‚ã€åœ–ç‰‡è«‹æ±‚ã€æˆ–ç´”ç²¹å°±æ˜¯åŸ·è¡Œéç¨‹æ¼«é•·çš„ç¨‹å¼ç¢¼ï¼Œç•¶é€™äº›è·‘å¾—æ…¢çš„æ±è¥¿åˆè™•åœ¨ç›®å‰çš„å †ç–Šä¸Šï¼Œå°±æœƒé€ æˆã€ŒBlockingï¼ˆå µå¡ï¼‰ã€ã€‚

å¦‚æœç¾åœ¨æ˜¯åŒæ­¥è¨­å®šï¼Œé‚£éº¼ä¸€æ—¦ç™¼ç”Ÿ blockingï¼Œç•«é¢å°±æœƒå£æ‰ã€å¥½åƒã€Œå¡ä½ã€çš„ç¾è±¡ï¼Œé€™æ˜¯å› ç‚ºç€è¦½å™¨è¢«å¡ä½ã€ç„¡æ³•ç¹¼çºŒæ¸²æŸ“é é¢ï¼Œè®Šæˆæˆ‘å€‘ä»€éº¼äº‹éƒ½åšä¸äº†ï¼Œè€Œé¢å°é€™ç¨®ç‹€æ³ï¼Œæˆ‘å€‘å°±éœ€è¦ã€ŒéåŒæ­¥å›èª¿ï¼ˆAsync Callbackï¼‰ã€æ©Ÿåˆ¶ã€‚

ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯åœ¨éœ€è¦è·‘æ¯”è¼ƒä¹…çš„ç¨‹å¼ç¢¼ä¸­ç”¨ä¸ŠéåŒæ­¥æ–¹æ³•ï¼ˆAsynchronousï¼‰ï¼Œè£¡é¢å¡ä¸€å€‹ callback functionï¼ˆç°¡ç¨± cbï¼‰ï¼Œé€™æ¨£å°±æœƒå…ˆåŸ·è¡Œä¸€æ®µç¨‹å¼ç¢¼ï¼Œç„¶å¾Œéæ®µæ™‚é–“å†å›èª¿è£¡é¢çš„ cbï¼Œä¸æœƒç«‹å³åŸ·è¡Œåˆ°è€Œé€ æˆé˜»å¡ã€‚

### Concurrency ä¸¦è¡Œæ©Ÿåˆ¶
é‚£è‚¯å®šå°±æœƒå¥½å¥‡ï¼Œcallback function æ˜¯æ€éº¼åšåˆ°æœƒç­‰å¾…ä¸€æ®µæ™‚é–“å†åŸ·è¡Œï¼Ÿç‚ºä»€éº¼å®ƒèƒ½ç­‰åˆ°çµæŸåšã€èƒ½ç›£æ¸¬ä»€éº¼æ™‚å€™è¦çµæŸç­‰å¾…ï¼ŸJavaScript Runtime ä¸æ˜¯ä¸€ä»¶åªèƒ½åšä¸€ä»¶äº‹å—ï¼Ÿ

æ²’éŒ¯ï¼ŒJavaScript çš„ç¢ºæ˜¯å–®åŸ·è¡Œç·’ï¼Œå®ƒåœ¨åŸ·è¡Œä¸€æ®µç¨‹å¼ç¢¼çš„æ™‚å€™ï¼Œå°±ä¸èƒ½åŒæ™‚ç´€éŒ„ setTimeout çš„è¦æ±‚ã€åš HTTP Request ç¶²è·¯è«‹æ±‚ï¼Œè€Œè®“é€™ä¸€åˆ‡å¯¦ç¾çš„é—œéµä¸¦ä¸æ˜¯ JavaScriptï¼Œè€Œæ˜¯**ç€è¦½å™¨**ã€‚
ç€è¦½å™¨é¡å¤–æä¾›äº†å¾ˆå¤šæ±è¥¿ï¼Œé¡ä¼¼å„ç¨®ä¸åŒçš„åŸ·è¡Œç·’ï¼Œä¸€äº›ä½ åªèƒ½ç¶“ç”±å‘¼å«ã€ç„¡æ³•å–å¾—çš„åŸ·è¡Œç·’ï¼Œæ¯”å¦‚ setTimeout å°±æ˜¯å…¶ä¸­ä¸€å€‹ï¼Œå®ƒæ˜¯ç’°å¢ƒæ‰€æä¾›ï¼Œä¸¦éä¾†è‡ª JS Runtime æœ¬èº«ã€‚

ç•¶ä½ å‘¼å«å®ƒä¹‹å¾Œï¼Œç€è¦½å™¨å°±æœƒç‚ºä½ å•Ÿå‹•ä¸€å€‹è¨ˆæ™‚å™¨ï¼ŒJS ä¸»åŸ·è¡Œç·’å‰‡æœƒå¿½ç•¥å®ƒç¹¼çºŒå¾€ä¸‹é‹ä½œï¼Œè€Œ `setTimeout()` å¯¦éš›ä¸Šæ˜¯å‡ºç¾åœ¨ç€è¦½å™¨å¦å¤–æä¾›çš„åŸ·è¡Œç·’ä¸­åŸ·è¡Œï¼Œå…¶ä»–åƒ ajaxã€Fetchã€DOM ä¹Ÿéƒ½æ˜¯ç€è¦½å™¨æä¾›çš„ APIã€‚

![](https://i.imgur.com/TVo3hwu.png)


### Event Loop å’Œ Callback Queue
é‚£ `setTimeout()` åŸ·è¡Œå®Œç•¢å¾Œï¼Œè£¡é¢çš„ cb è©²æ€éº¼è™•ç†ï¼Ÿå‰›å‰›èªªåˆ°æœƒã€Œå›èª¿ã€ï¼Œé‚£æ˜¯ä¸Ÿå›å †ç–Šä¸­ç›´æ¥åŸ·è¡Œå—ï¼Ÿ

ç•¶ç„¶ä¸å¯èƒ½å¦‚æ­¤ç°¡å–®ç²—æš´ï¼Œç€è¦½å™¨ä¸æœƒå‚»å‘¼å‘¼ç›´æ¥ä¸Ÿå›å †ç–Šä¸Šï¼Œé€™æ¨£æ ¹æœ¬ç„¡æ³•æ§åˆ¶å®ƒå‡ºç¾çš„æ™‚æ©Ÿï¼ŒWeb APIs æœƒåœ¨åŸ·è¡Œå®Œ `setTimeout()` ä¹‹å¾Œå°‡å®ƒçš„ cb æ”¾åˆ°ä¸€å€‹åç‚º
Callback Queue çš„åœ°æ–¹ï¼Œæ‰€æœ‰éåŒæ­¥åŸ·è¡Œçš„ç¨‹å¼ç¢¼æœƒè¢«æ¨åˆ°é€™è£¡ç­‰å¾…åŸ·è¡Œã€‚

è€Œå®‰æ’ Callback Queue è£¡é¢çš„ä»»å‹™å»åˆ°å †ç–Šï¼Œæ˜¯ç”±ã€ŒEvent Loopï¼ˆäº‹ä»¶å¾ªç’°ï¼‰ã€è² è²¬ï¼Œä½ å¯ä»¥æƒ³åƒå®ƒå°±æ˜¯åœ¨è¾¦å…¬å¤§æ¨“ä¸Šç­çš„è­¦è¡›ï¼Œå°–å³°æ™‚ç«¯æ“ æ»¿ä¸€å †è¦ä¸Šæ¨“çš„ä¸Šç­æ—ï¼Œè€Œå¤§å®¶æ»‘è‘—æ‰‹æ©Ÿã€éƒ½åœ¨æ’éšŠç­‰å¾…é›»æ¢¯ï¼Œé›»æ¢¯å¾ˆå°ï¼Œä¸€æ¬¡åªèƒ½å®¹ç´ä¸€å€‹äººï¼Œå°±æ˜¯é€™ä½è­¦è¡›ä¾†å¹«ä»–å€‘è§€å¯Ÿé›»æ¢¯ä»€éº¼æ™‚å€™ç©ºå‡ºä¾†ï¼Œä¸€æ—¦é›»æ¢¯æŠµé”ä¸€æ¨“ï¼Œå°±é€šçŸ¥æ’éšŠçš„ç¬¬ä¸€å€‹äººå¯ä»¥ä¸Šç­äº†ã€‚

Event Loop æ±ºå®šäº‹ä»¶çš„åŸ·è¡Œé †åºï¼Œå®ƒä¸æ–·ç›£æ§ stack å’Œ queue çš„ç‹€æ…‹ï¼ŒæŸ¥åˆ°å †ç–Šçš„ç‹€æ…‹æ˜¯ç©ºçš„ï¼Œå°±æ›æª¢æŸ¥ Callback Queue ä¸­æœ‰æ²’æœ‰æº–å‚™å¥½çš„ cbï¼Œå°±æŠŠæœ€å‰é¢çš„ cb æŠ“èµ·ä¾†é€åˆ°å †ç–Šä¸ŠåŸ·è¡Œï¼Œæ‰€ä»¥å¯ä»¥èªª JavaScript å¯ä»¥ä¸¦è¡Œçš„åŸºç¤æ˜¯å› ç‚º Event Loop çš„å­˜åœ¨ã€‚

![](https://i.imgur.com/PBYJawC.png)

### æ›´é€²ä¸€æ­¥ï¼šèªè­˜ç€è¦½å™¨çš„é‹è¡Œç’°å¢ƒ
å¾ä¸Šé¢æˆ‘å€‘çŸ¥é“äº†åœ¨ JS Runtime ä¹‹å¤–ï¼Œç€è¦½å™¨é‚„æä¾›äº† Web APIsã€Queueã€Event Loop ç­‰ç­‰æ±è¥¿ä¾†å¹«åŠ©ä»»å‹™åŸ·è¡Œï¼Œæ•´å€‹ç€è¦½å™¨çš„é‹ä½œç’°å¢ƒï¼ŒåŒ…å« JS å¼•æ“ï¼Œæˆ‘å€‘ç¨±ç‚º JS Runtime Environmentï¼ˆJREï¼‰

![](https://ithelp.ithome.com.tw/upload/images/20190928/20106580oVudusuOwX.jpg)


#### Q: é›¶å»¶é²ï¼ˆZero delaysï¼‰æ˜¯ä»€éº¼ï¼Ÿ
æœ‰æ™‚å€™æˆ‘å€‘æœƒçœ‹åˆ°å°‡ setTimeout è¨­æˆé›¶ï¼Œé€™éº¼åšä¸¦éè¡¨ç¤º callback function æœƒåœ¨ 0 æ¯«ç§’ä¹‹å¾Œç«‹åˆ»åŸ·è¡Œï¼Œå¾ä¸Šé¢ Event Loop çš„é‹ä½œæˆ‘å€‘äº†è§£åˆ°ï¼šé€™å€‹ cb æœƒç­‰å¾…å †ç–Šæ¸…ç©ºå¾Œæ‰è¢«åŸ·è¡Œåˆ°ã€‚

å‘¼å« setTimeout çš„ä½¿ç”¨ï¼Œä¸ä»£è¡¨éäº†é‚£æ®µæ™‚é–“å°±æœƒåŸ·è¡Œï¼Œæ™‚é–“åƒæ•¸åªæ˜¯è¦æ±‚è™•ç†çš„æœ€å°‘ç­‰å¾…æ™‚é–“ï¼Œæˆ‘å€‘é‚„å¾—è€ƒæ…®åˆ°åœ¨ Queue ä¸­ç­‰å¾…çš„è¨Šæ¯æ•¸é‡ï¼ŒsetTimeout æ˜¯è®“æˆ‘å€‘æŠŠä»»å‹™æ¨é²åˆ°å †ç–Šçš„æœ€å¾Œå†åŸ·è¡Œã€‚

```javascript=
(function() {

  console.log('this is the start');

  setTimeout(function cb() {
    console.log('this is a msg from call back');
  });

  console.log('this is just a message');

  setTimeout(function cb1() {
    console.log('this is a msg from call back1');
  }, 0);

  console.log('this is the end');

})();

// "this is the start"
// "this is just a message"
// "this is the end"
// "this is a msg from call back"
// "this is a msg from call back1"
```
#### Q: ç‚ºä»€éº¼èªªä¸è¦åšäº‹ä»¶é˜»å¡ï¼Ÿ
æ„æ€æ˜¯ï¼Œè®“ä½ åˆ¥åœ¨å †ç–Šä¸Šæ”¾æ…¢åˆ°ä¸è¡Œçš„ç¨‹å¼ç¢¼ï¼Œé€™æ¨£æœƒå½±éŸ¿ç€è¦½å™¨æœ€é‡è¦çš„æ±è¥¿â”€â”€ ç•«é¢ã€‚

ä¸€èˆ¬ä¾†èªªï¼Œç€è¦½å™¨æœƒåœ¨æ¯ 16.6 æ¯«ç§’ï¼ˆä¹Ÿå°±æ˜¯æ¯ç§’ 60 å€‹å¹€ï¼‰é‡æ–°æ¸²æŸ“ä¸€æ¬¡ç•«é¢ï¼Œä½†ç•¶å †ç–Šä¸Šæœ‰ç¨‹å¼ç¢¼çš„æ™‚å€™ï¼Œç€è¦½å™¨å°±ä¸èƒ½é¡¯ç¤ºæ±è¥¿ï¼Œé€ æˆå¡ä½ã€‚æ¯”å¦‚ `forEach()` è£¡é¢çš„å‡½å¼å°±ä¸æœƒåšéåŒæ­¥ï¼Œè€Œæ˜¯åœ¨ç•¶å‰çš„å †ç–Šä¸­åŸ·è¡Œï¼Œç•¶ä½ å°æ¯å€‹å…ƒç´ åšç·©æ…¢è™•ç†çš„åŒæ­¥è¿´åœˆï¼Œå°±æœƒè®“ç€è¦½å™¨çš„é¡¯ç¤ºä¸€ç›´è¢«æ“‹ä½ã€‚

```javascript=
// Synchronous
[1, 2, 3, 4].forEach(function (i) {
  console.log(i)
  delay()
})
```

è€Œç•¶ä½ çŸ¥é“æ¸²æŸ“ä»»å‹™çš„å„ªå…ˆæ¬Šé«˜æ–¼ callback functionï¼Œä½ å°±æ‡‰è©²é‡æ–°æ€è€ƒç¨‹å¼ç¢¼çš„æ¶æ§‹ï¼Œåƒæ˜¯å°‡å®ƒæ”¹ç‚ºå›èª¿å‡½å¼ï¼Œç•¶ä»–å€‘åŒæ¨£éƒ½åœ¨ Queue ä¸­ç­‰å¾…æ™‚ï¼Œç€è¦½å™¨å°±å¯ä»¥è‡ªå·±æ‰¾åˆ°æ©Ÿæœƒå®‰æ’æ¸²æŸ“ä»»å‹™ï¼Œé †åˆ©ä¿æŒæµæš¢çš„ UIã€‚
```javascript=
// Asynchronous
function asyncForEach(array, cb) {
  array.forEach(function () {
    setTimeout(cb, 0)
  })
}
```

### Q: ç‚ºä»€éº¼ JavaScript æœƒæ˜¯å–®åŸ·è¡Œç·’çš„ç¨‹å¼èªè¨€ï¼Ÿ
> ç‚ºä»€éº¼ JavaScript åªèƒ½è·‘åœ¨ä¸€å€‹ thread ä¸Šï¼Œä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼Ÿ

èˆ‡ä»–çš„ç”¨é€”æœ‰é—œï¼Œç•¶åˆ JavaScript æ˜¯ç‚ºäº†åœ¨ç€è¦½å™¨ä¸Šé‹ä½œï¼Œèˆ‡ä½¿ç”¨è€…äº’å‹•ä»¥åŠæ“ä½œDOMè€Œè¨­è¨ˆçš„ï¼Œé€™æ±ºå®šäº†ä»–åªèƒ½æ˜¯å–®åŸ·è¡Œç·’ï¼Œå¦å‰‡æœƒå¸¶ä¾†å¾ˆè¤‡é›œçš„åŒæ­¥å•é¡Œã€‚æ¯”å¦‚åŒæ™‚æœ‰å…©å€‹åŸ·è¡Œç·’å­˜å–åˆ°åŒä¸€å€‹ DOM ç¯€é»ï¼š
* ä¸€å€‹åŸ·è¡Œç·’åœ¨æŸå€‹ DOM ç¯€é»ä¸Šæ–°å¢å…§å®¹
* å¦ä¸€å€‹åŸ·è¡Œç·’åˆªé™¤äº†é€™å€‹ç¯€é»

ç€è¦½å™¨è¦ä»¥å“ªå€‹ç‚ºä¸»ï¼Ÿç‚ºäº†é¿å…é€™ç¨®éº»ç…©æ‰é€™æ¨£è¨­è¨ˆï¼Œä¹‹å‰å¯«é Android é–‹ç™¼ï¼Œä¹Ÿç™¼ç¾æœƒè¦æ±‚ä»»ä½•è·Ÿ UI æœ‰é—œçš„æ“ä½œéƒ½å¾—åœ¨ä¸»åŸ·è¡Œç·’é€²è¡Œï¼Œå°±æ˜¯ç‚ºäº†é¿å…ç„¡æ³•é æ–™çš„ç‹€æ³ã€‚

### å°çµ
* å †ç–Šç•¶ä¸‹çš„ç¨‹å¼ç¢¼æœƒåŸ·è¡Œå®Œç•¢ï¼Œéç¨‹ä¸­ä¸æœƒè¢« async code ä¸­æ–·
* å°±ç®— setTimeout() å»¶é²æ™‚é–“è¨­å®šç‚º 0ï¼Œç¨‹å¼ä¹Ÿä¸æœƒç«‹å³åŸ·è¡Œåˆ°ï¼Œä¾ç„¶æœƒè¢«æ’åœ¨ Callback Queue ç­‰å¾…å †ç–Šæ¸…ç©º
* JavaScript åªèƒ½è·‘å–®åŸ·è¡Œç·’ï¼Œä½†ç€è¦½å™¨åƒæ˜¯æä¾›äº†å®ƒé‹ä½œå¤šåŸ·è¡Œç·’çš„å¯èƒ½ï¼Œåˆ©ç”¨ Event Loop æ©Ÿåˆ¶å»å¹«åŠ© JavaScript åŸ·è¡Œä»»å‹™
* ç€è¦½å™¨ä¸­ï¼Œæ¸²æŸ“ç•«é¢çš„å„ªå…ˆæ¬Šé«˜æ–¼ callback function


### åƒè€ƒè³‡æ–™
* [Javascript [ç­†è¨˜] ç†è§£ Event Loop,Call Stack, Event & Job Queue in Javascript](hhttps://milletbard.com/2019/11/25/JavaScript-event-loop/)
* [ä¸¦è¡Œæ¨¡å‹å’Œäº‹ä»¶å¾ªç’°](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/EventLoop)
* [[ç­†è¨˜] ç†è§£ JavaScript ä¸­çš„äº‹ä»¶å¾ªç’°ã€å †ç–Šã€ä½‡åˆ—å’Œä½µç™¼æ¨¡å¼](https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html)
* [[ç¬¬åå…­é€±] JavaScript é€²éšï¼šäº‹ä»¶è¿´åœˆ Event Loopã€Stackã€Queue](https://yakimhsu.com/project/project_w16_EventLoop.html)
* [Day5 [JavaScript åŸºç¤] Event Loop æ©Ÿåˆ¶](https://ithelp.ithome.com.tw/articles/10214017)
* [JS åŸåŠ›è¦ºé†’ Day13 - Event Queue & Event Loop ã€Event Table](https://ithelp.ithome.com.tw/articles/10221944)


---
##  JavaScript çš„ä¸€äº›é‡è¦åŸºç¤ï¼šscopeã€hoistingã€closureã€prototypeã€this

### Scope ä½œç”¨åŸŸ
ä½œç”¨åŸŸæ˜¯ä¸€å€‹è®Šæ•¸çš„ç”Ÿå­˜ç¯„åœï¼Œä¸€æ—¦è¶…å‡ºäº†é€™å€‹ç¯„åœï¼Œå°±ç„¡æ³•å­˜å–åˆ°é€™å€‹è®Šæ•¸ï¼Œé‚£æ—¢ç„¶ä½œç”¨åŸŸæ±ºå®šäº†è®Šæ•¸æœ‰æ•ˆçš„ç¯„ç–‡ï¼Œå®ƒæ˜¯æ€éº¼æ±ºå®šçš„ï¼Ÿ

JS æ¡ç”¨çš„æ˜¯**éœæ…‹ä½œç”¨åŸŸï¼ˆstatic scopeï¼‰**ï¼Œä½œç”¨åŸŸçš„åˆ¤æ–·ï¼Œè·Ÿå“ªé‚Šå‘¼å«æ²’æœ‰é—œä¿‚ï¼Œæ˜¯çœ‹å®ƒåœ¨å“ªè£¡è¢«å®£å‘Šï¼Œä»¥å®£å‘Šå‡½å¼çš„åœ°æ–¹ç•¶ä½œä½œç”¨åŸŸéˆï¼ŒJavaScript ä½œç”¨åŸŸåˆ†æˆä¸‰å€‹å±¤ç´šï¼š
1. Global Level Scope
2. Function Level Scope
3. Block Level Scopeï¼ˆES6 ä¹‹å¾Œï¼‰

å‰é¢æåˆ°é JavaScript ä»£ç¢¼åœ¨é‹è¡Œä¹‹å‰ï¼Œæœƒç”¢ç”Ÿä¸€å€‹é»˜èªçš„å…¨åŸŸåŸ·è¡Œç’°å¢ƒ ï¼ˆGlobal Execution Contextï¼‰ï¼Œå®ƒè£¡é¢æœƒå­˜åœ¨ä¸€å€‹å…¨åŸŸçš„è®Šæ•¸ç‰©ä»¶ï¼ˆGlobal Variable Objectï¼‰ï¼Œåœ¨é€™å€‹ç¯„åœè¢«å®£å‘Šçš„è®Šæ•¸å°±æ˜¯ã€Œå…¨åŸŸè®Šæ•¸ã€ï¼Œä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å­˜å–åˆ°å®ƒã€‚

è€Œåœ¨ ES6 ä»¥å‰ï¼Œä½œç”¨åŸŸåŸºæœ¬å–®ä½æ˜¯ functionï¼Œæ¯ä¸€å€‹ function æœƒå½¢æˆä¸€å€‹æ–°çš„ä½œç”¨åŸŸï¼Œåœ¨ function çš„å¤–é¢ä½ æ˜¯å–ä¸åˆ°å®ƒè£¡é¢çš„è®Šæ•¸ï¼Œåœ¨ ES6 ä¹‹å¾Œå‡ºç¾äº† let å’Œ constï¼Œç”¨å®ƒå€‘å®£å‘Šçš„ä½œç”¨åŸŸæ˜¯ä»¥ block ç‚ºå–®ä½ï¼Œåªè¦æœ‰ `{}` å°±æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ä½œç”¨åŸŸã€‚


```javascript=
// å…ˆåœ¨è‡ªå·±çš„ä½œç”¨åŸŸè£¡é¢æ‰¾ï¼Œæ‰¾ä¸åˆ°æ‰æœƒå¾€ä¸Šä¸€å±¤å» global æ‰¾
var a = 10
function test() {
    var a = 20
    console.log(a) // 20
}
test()
console.log(a)     // 10


//æ²’æœ‰é‡æ–°å®£å‘Šï¼Œå¾€ä¸Šå±¤æ‰¾ global è®Šæ•¸ aï¼Œåœ¨ test è£¡é¢è¢«è³¦å€¼ï¼Œa è¢«æ”¹è®Šç‚º 20
var a = 10
function test() {
    a = 20
    console.log(a) // 20
}

test()
console.log(a)     // 20
```



### Hoisting æå‡
ä¸ç®¡ä½ åœ¨å‡½å¼ä¸­çš„å“ªä¸€è¡Œç”¨æ–¼å®£å‘Šè®Šæ•¸ï¼Œä¸€å¾‹è¢«è¦–ç‚ºåœ¨å‡½å¼çš„ç¬¬ä¸€è¡Œå®£å‘Š
```javascript=
console.log(b);   //undefined
var b = 10;

// ä¸Šé¢ç­‰æ–¼ä¸‹é¢é€™æ®µ
var b;
console.log(b);
b = 10;
```
* åªæœ‰å®£å‘Šæœƒæå‡ï¼Œè³¦å€¼ä¸æœƒ
* var å®£å‘Šæå‡å¾Œï¼Œæœƒå…ˆè¢«åˆå§‹åŒ–ç‚º undefined
* hoisting çš„ç¯„åœå°±æ˜¯ç•¶å‰çš„ä½œç”¨åŸŸ
* æå‡çš„å„ªå…ˆé †åºæ˜¯
```
function å‡½å¼ -> argument åƒæ•¸ -> variable è®Šæ•¸
```

#### æ²’æœ‰ hoistingï¼Ÿlet å’Œ const çš„ä¸åŒ
å’Œ var çš„å·®åˆ¥åœ¨æ–¼æå‡ä¹‹å¾Œï¼Œvar å®£å‘Šçš„è®Šæ•¸æœƒè¢«åˆå§‹åŒ–ç‚º undefinedï¼Œä½† let èˆ‡ const çš„å®£å‘Šä¸æœƒï¼Œå°è‡´ let å’Œ const åœ¨è³¦å€¼ä»¥å‰éƒ½ä¸èƒ½å»å­˜å–å®ƒï¼Œä¸ç„¶æœƒå ±éŒ¯èª¤ï¼Œå¾ä»–å€‘å®£å‘Šåˆ°è¢«è³¦å€¼ä¸­é–“æœƒæœ‰ä¸€æ®µç©ºç™½æœŸï¼Œè¢«ç¨±ç‚ºã€ŒTemporal Dead Zoneï¼ˆTDZï¼‰ã€

```javascript=
function  test ( )  { 
    // cçš„TDZé–‹å§‹
    console . log ( c )  //éŒ¯èª¤
    let  c  =  10        // cçš„TDZçµæŸ
} 
test ( )
```

#### Scope å’Œ Hoisting å°çµè«–
* let å’Œ const éƒ½æ˜¯ block-level scopeï¼ˆå¡Šç´šä½œç”¨åŸŸï¼‰ï¼Œè€Œ var æ˜¯å‡½å¼ä½œç”¨åŸŸ
* var å¯é‡è¤‡å®£å‘Š
* let å’Œ const å…¶å¯¦ä¹Ÿæœ‰ hoistingï¼Œæœƒæå‡åˆ°å€å¡Šä½œç”¨åŸŸé ‚éƒ¨ï¼Œä½†åœ¨è³¦å€¼ä¹‹å‰éƒ½ä¸èƒ½å»å­˜å–å®ƒï¼Œä¸ç„¶æœƒå ±éŒ¯èª¤ `ReferenceError`

### å¾ ECMAScript ä¾†ç†è§£ Hoistingã€èªè­˜ Scope Chain
ä»¥ä¸‹æ˜¯é€™æ®µç¨‹å¼ç¢¼çš„é‹è¡Œçµæœ
```javascript=
var a = 1;
function test(){
  console.log('1.', a);  // å°å‡º undefined => ä¸‹é¢æœ‰açš„è®Šæ•¸å®£å‘Šï¼Œæ–¼æ˜¯hoisting
  var a = 7;
  console.log('2.', a);  // å°å‡º 7
  a++;                   // a++ è®Šæˆ 8
  var a;
  inner();
  console.log('4.', a);  // å°å‡º 30
  function inner(){
    console.log('3.', a);// ä¸‹é¢åªæœ‰è³¦å€¼ï¼Œæ²’æœ‰å®£å‘Šï¼Œæ‰€ä»¥å¾€ä¸Šä¸€å±¤æ‰¾åˆ° a æ˜¯ 8
    a = 30;              // æŠŠ test é‚£å±¤çš„ a æ”¹æˆ 30
    b = 200;             // åªæœ‰è³¦å€¼ï¼Œå¾€ä¸Šä¹Ÿæ‰¾ä¸åˆ°bï¼Œbè¢«å®£å‘Šæˆå…¨åŸŸè®Šæ•¸
  }
}
test();
console.log('5.', a);   // å°å‡º 1
a = 70;
console.log('6.', a);   // å°å‡º 70
console.log('7.', b);   // å°å‡º 200
```

æœ€é–‹å§‹æˆ‘å€‘æéï¼Œåœ¨ç¨‹å¼ç¢¼é‹è¡Œå‰ JS çš„ Runtimeï¼ˆè¨˜æ†¶é«”å †ç–Šã€é»˜èªåŸ·è¡Œç’°å¢ƒã€åŸ·è¡Œç’°å¢ƒå †ç–Šï¼‰æœƒè¢«å»ºç«‹ï¼Œé»˜èªåŸ·è¡Œç’°å¢ƒä¹Ÿå°±æ˜¯å…¨åŸŸåŸ·è¡Œç’°å¢ƒ Global Execution Contextï¼Œå®ƒè£¡é¢å­˜æ”¾è‘—ç’°å¢ƒä¸­æœƒéœ€è¦ç”¨åˆ°çš„å„ç¨®è³‡æºï¼ŒåŒ…æ‹¬
* éšæ®µï¼ˆPhaseï¼‰
* å…¨åŸŸç‰©ä»¶ï¼ˆGlobal Objectï¼‰
* this
* è®Šæ•¸ç‰©ä»¶ï¼ˆVariable Objectï¼‰
* ç¯„åœéˆï¼ˆScope Chainï¼‰

```javascript=
globalEC = {
  Phase: 'Execution',      // é‹è¡Œéšæ®µ
  GlobalObject: window,    // åœ¨ç€è¦½å™¨ä¸­ï¼Œå…¨åŸŸç‰©ä»¶ä¾¿æ˜¯æŒ‡ Web API
  this: window,            // åœ¨ç€è¦½å™¨ä¸­ï¼Œthis æ‰€æŒ‡å‘çš„ä¾¿æ˜¯ç€è¦½å™¨ç‰©ä»¶ window
  VO: {                    // è®Šæ•¸ç‰©ä»¶ï¼ˆVariable Objectï¼‰
    a: 1,
    b: 2,
  }
  scopeChain: globalEC.VO  // å› ç‚ºå·²ç¶“æ˜¯æœ€å¤–å±¤
}
```
Scope Chain æ˜¯ç”±å®ƒçš„ Variable Object åŠ ä¸Šæœ¬èº«çš„ `scope å±¬æ€§` æ‰€çµ„æˆï¼Œ`scope å±¬æ€§` æ˜¯åœ¨å®£å‘Šæ¯ä¸€å€‹ function æ™‚å°±æ±ºå®šå¥½çš„ï¼Œä½†å› ç‚º globalEC ä¸æ˜¯ functionï¼Œæ‰€ä»¥å®ƒä¸¦æ²’æœ‰ scope å±¬æ€§ï¼Œå®ƒçš„ scope chain è£¡é¢åªæœ‰ `globalEC.VO`ã€‚


![](https://i.imgur.com/izhahjR.png)

é€™å¼µåœ–ä¸Šï¼Œå…¶ä»–è¢«æ”¾åœ¨å †ç–Šä¸­çš„ Execution Contextï¼Œå°±æ˜¯å‡½å¼åŸ·è¡Œç’°å¢ƒ Function Execution Contextï¼Œä¸€æ—¦å‘¼å«åˆ°æŸå‡½å¼ï¼ŒglobalEC å°±æœƒç‚ºè©²å‡½å¼å»ºç«‹ä¸€å€‹å…¨æ–°çš„åŸ·è¡Œç’°å¢ƒï¼Œå°ˆé–€ä¾›å®ƒè£¡é¢çš„ç¨‹å¼ç¢¼é‹è¡Œï¼Œé€™å€‹æ–°çš„ç’°å¢ƒæœƒè¢«å †ç–Šåœ¨åŸæœ¬çš„ globalEC ä¸Šé¢ã€‚


#### Function Execution Context åŸ·è¡Œç’°å¢ƒ
å‡½å¼åŸ·è¡Œç’°å¢ƒæŒ‡çš„æ˜¯åŸ·è¡Œå‡½å¼æ™‚æ‰€å‰µç«‹åŸ·è¡Œç’°å¢ƒï¼Œè£¡é¢åŒ…å«äº†ï¼š
* éšæ®µï¼ˆPhaseï¼‰
* this
* åŸ·è¡Œç‰©ä»¶ï¼ˆActivation Objectï¼‰
* ä½œç”¨åŸŸéˆï¼ˆScope Chainï¼‰

æ‰€æœ‰åœ¨ function EC å®£å‘Šçš„è®Šæ•¸å’Œå‡½å¼ï¼Œéƒ½æœƒè¢«åŠ åˆ° Activation Object ç‰©ä»¶è£¡ï¼Œä½ å¯èƒ½æœƒç–‘æƒ‘ global EC è£¡é¢æ˜¯ VOã€function EC å»æ˜¯ AOï¼Ÿå…©è€…å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ

æˆ‘å€‘éƒ½çŸ¥é“æ¯å€‹åŸ·è¡Œç’°å¢ƒæœƒåŒ…å«è®Šæ•¸ç‰©ä»¶ï¼ˆVariable Objectï¼‰ï¼Œè€ŒåŸ·è¡Œå‡½å¼æ‰€å‰µé€ å‡ºä¾†çš„åŸ·è¡Œç’°å¢ƒä¸­ï¼Œå‰‡æœƒå¦æŠŠåƒæ•¸ï¼ˆparametersï¼‰ä¹ŸåŠ é€²å»è®Šæ•¸ç‰©ä»¶ä¸­ï¼Œé€™å€‹å¤šäº†åƒæ•¸çš„è®Šæ•¸ç‰©ä»¶å°±è¢«ç¨±ç‚ºæ˜¯ã€Œæ´»åŒ–çš„è®Šæ•¸ç‰©ä»¶ï¼ˆAcativation Objectï¼‰ã€ï¼Œæœ¬è³ªä¸Šå®ƒé‚„æ˜¯è®Šæ•¸ç‰©ä»¶ï¼Œåªæ˜¯ç‰ˆæœ¬ä¸ä¸€æ¨£ã€‚

ç•¶é€²å…¥ EC æ™‚æœƒç”¢ç”Ÿ AO ç‰©ä»¶ï¼Œé–‹å§‹è®Šæ•¸ç‰©ä»¶çš„å»ºç«‹ï¼š
1. æª¢æŸ¥æœ‰æ²’æœ‰åƒæ•¸ï¼Œåƒæ•¸æœƒå…ˆè¢«ç¶åˆ° AOï¼Œåˆå§‹åŒ–ä¸¦çµ¦å€¼
2. åˆå§‹åŒ– function å’Œè®Šæ•¸
3. å¦‚æœè£¡é¢å‡ºç¾èˆ‡åƒæ•¸åŒåçš„ function åç¨±ï¼Œå–ä»£è©²åƒæ•¸
4. å¦‚æœè£¡é¢å‡ºç¾èˆ‡åƒæ•¸æˆ– function åŒåçš„è®Šæ•¸å®£å‘Šï¼Œç›´æ¥å¿½ç•¥

```javascript=
fnEC = {
  Phase: 'Creation',     // å‰µé€ éšæ®µ
  this: ,
  AO: {                  // åŸ·è¡Œç‰©ä»¶
    arguments: { 
        0: 1,
        1: 2,
        length: 2
    },
    a: func,
    b: undefined,
  },
  scopeChain: (AO + fnEC.[[Scope]])
  // scopeChain ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯å®£å‘Šç¨‹å¼æ™‚è™•åœ¨çš„å¤–å±¤ç¯„åœï¼ŒåŠ ä¸Šè‡ªå·±çš„åŸ·è¡Œç‰©ä»¶
}
```

åšå®Œäº†ä¹‹å¾Œï¼Œæ‰é–‹å§‹æŒ‰ç…§é †åºåŸ·è¡Œç¨‹å¼ç¢¼ï¼Œåœ¨ç¨‹å¼ç¢¼è£¡é¢å¦‚æœå‘¼å«åˆ°å…¶ä»– function ï¼Œå°±æœƒç–Šä¸Šä¸€å±¤ ECï¼Œè€Œåœ¨ funciton åŸ·è¡Œå®Œå¾Œï¼Œé€™å±¤ EC å°±æœƒè¢«æŠ½æ‰ï¼Œé‡‹æ”¾å‡ºè³‡æºï¼Œé€™èˆ‡æˆ‘å€‘å‰é¢ç†è§£çš„å †ç–Šæ©Ÿåˆ¶ç›¸ç¬¦åˆã€‚

ç•¶é€²å…¥ä¸€å€‹æ–°çš„ EC æ™‚ï¼Œå®ƒçš„ AO å’Œ scope chain éƒ½æœƒè¢«å»ºç«‹ï¼Œscope chain ç”±å®ƒæœ¬èº«çš„ VO/AO åŠ ä¸Š scope å±¬æ€§çµ„æˆï¼Œè€Œå®ƒæœ¬èº« scope å±¬æ€§æ˜¯åœ¨å®£å‘Š function æ™‚å°±æ±ºå®šå¥½çš„ï¼ˆå…¶å¯¦å°±æ˜¯å®ƒé‚£ä¸€å±¤ EC çš„ scope chainï¼‰

**ç¤ºç¯„ Execution Content å’Œ Scope Chain ç¨‹å¼ç¢¼**
```javascript=
// Example
var a = 1
function test() {
    var b = 2
    funciton inner() {
        var c = 3
        console.log(a)
        console.log(b)
    }
    inner()
}

test()
```
JS åˆ°åº•æ˜¯æ€éº¼æŸ¥æ‰¾è®Šæ•¸çš„ï¼Œå…¶å¯¦å°±æ˜¯é€é Scope Chain é€™å€‹é è¨­å±¬æ€§
```javascript=
innerEC {
    AO: {
        c: undefined, 
    },
    scopeChain: [innerEC.AO, innerEC.[[scope]]]
    // ==> [innerEC.VO, testEC.AO, globalEC.VO]
}

testEC {
    AO: {
        b: 2,
        inner: func,
    },
    scopeChain: [testEC.AO, test.[[scope]]]  // ==> [testEC.AO, globalEC.VO]
}

// å®£å‘Š function innerï¼Œå¤šä¸€å€‹å®ƒè‡ªå·±çš„éš±è—å±¬æ€§ [[Scope]]
// inner.[[scope]] = testEC.scopeChain   ==> [testEC.AO, globalEC.VO]


globalEC {
    VO: {
        a: 1,
        test: func
    },
    scopeChain: [globalEC.VO]
}

// å®£å‘Š function testï¼Œå¤šä¸€å€‹å®ƒè‡ªå·±çš„éš±è—å±¬æ€§ [[Scope]]
// é€™æ™‚ test.[[scope]] = globalEC.scopeChain   //globleEC.VO
```

#### é—œæ–¼ Execution Content å’Œ Scope Chain å°çµè«–
* æ¯ä¸€å€‹ funciton éƒ½æœ‰ä¸€å€‹ ECï¼Œæ‰€æœ‰è©² function éœ€è¦çš„è³‡è¨Šéƒ½æ˜¯å­˜åœ¨é€™å€‹ EC ä¸­
* é™¤äº† function æœ‰ ECï¼Œæœ€åº•å±¤é‚„æœ‰ä¸€å€‹ global EC
* å †ç–Šæœ€ä¸Šå±¤çš„ï¼Œå°±æ˜¯ç¾åœ¨è·‘çš„ Execution Context
* æ¯ä¸€å€‹ function éƒ½æœ‰è‡ªå·±çš„ `[[scope]]` å±¬æ€§
* `[[scope]]` å±¬æ€§å°±æ˜¯å®£å‘Š function æ™‚è™•åœ¨çš„å¤–å±¤ç¯„åœ
* Hoisting å’Œ TDZ æ¦‚å¿µå…¶å¯¦éƒ½æ˜¯å¾ scope chain å»¶ä¼¸å‡ºçš„çµè«–


### åƒè€ƒè³‡æ–™
* [ç§’æ‡‚ï¼JavaSript åŸ·è¡Œç’°å¢ƒèˆ‡å †ç–Š](https://medium.com/%E9%AD%94%E9%AC%BC%E8%97%8F%E5%9C%A8%E7%A8%8B%E5%BC%8F%E7%B4%B0%E7%AF%80%E8%A3%A1/%E6%B7%BA%E8%AB%87-javascript-%E5%9F%B7%E8%A1%8C%E7%92%B0%E5%A2%83-2976b3eaf248)
* [æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿ](https://blog.huli.tw/2018/11/10/javascript-hoisting-and-tdz/)
* [JavaScript æ·±å…¥æ·ºå‡º Variable Object & Activation Object](https://shawnlin0201.github.io/JavaScript/JavaScript-Variable-Object-and-Activation-Object/)
* [JavaScript æ·±å…¥æ·ºå‡º Execution Content åŸ·è¡Œç’°å¢ƒ](https://shawnlin0201.github.io/JavaScript/JavaScript-Execution-Context/)

---

### è£œå……ï¼šé–‰åŒ… Closure 
ç†è§£ Scope chain å¾Œï¼Œæˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥çŸ¥é“é–‰åŒ…çš„å¯¦ç¾æ©Ÿåˆ¶ï¼Œé–‰åŒ… Closure åœ¨ä¸€å€‹ function è£¡é¢ retutn ä¸€å€‹ functionï¼ŒæŠŠ function è£¡é¢çš„å€¼é–åœ¨è£¡é¢ï¼Œè€Œä¸åƒå¾€å¸¸ä¸€æ¨£åŸ·è¡Œå®Œå°±è¢«é‡‹æ”¾è³‡æº
* è¨ˆç®—è¤‡é›œæ™‚
* æƒ³è¦éš±è—æŸäº›è³‡è¨Šæ™‚ï¼Œèƒ½æŠŠè®Šæ•¸éš±è—åœ¨è£¡é¢è®“å¤–éƒ¨å­˜å–ä¸åˆ°


### ç‰©ä»¶å°å‘
ES6 ä»¥å¾Œæœ‰ `class` å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥å‰µå»ºä¸€å€‹å°è±¡ï¼Œå°å®ƒåšäº‹ã€‚

```javascript=
class Dog() {
    // å»ºæ§‹å­
    constructor(name) {
        this.name = name  // åœ¨å…§éƒ¨ç”¨ this å»æŒ‡ä»–ç¾åœ¨çš„ instrance çš„ name
    }
    // setter
    setName(name) {
        this.name = name
    }
    
    // getter
    getName() {
        return this.name
    }
    
    sayHello() {
        console.log('hello')
    }
}

// newï¼Œå¯¦éš›ä¸Šå°±æ˜¯åœ¨å‘¼å« constructor é€™å€‹å…§å»ºæ–¹æ³•
var d = new Dog('belly')  // instance 
d.setName('abc')
console.log(d.getName())  // abc
```



#### èªè­˜åŸå‹ç·´ï¼ˆprototype chainï¼‰
JavaScript ä¸åƒå…¶ä»–èªè¨€ä¸­æœ‰ã€Œé¡åˆ¥ã€çš„æ¦‚å¿µï¼Œå³ä½¿æ˜¯ ES6ï¼ˆæœ‰ Class èªæ³•ï¼‰è£¡é¢åªæ˜¯ç”¨ä¸€å€‹é¡ä¼¼çš„æ©Ÿåˆ¶ä¾†é”åˆ°åŠŸèƒ½ï¼Œå¯¦éš›ä¸Šä»ç„¶ä¸æ˜¯å…¶ä»–èªè¨€æ‰€ç”¨çš„ã€ŒClassã€ï¼Œé‚£è¦çŸ¥é“é€™å€‹æ©Ÿåˆ¶æ˜¯æ€éº¼å¯¦ä½œçš„ï¼Ÿ

**çœ‹ ES6 ä»¥ä¸‹æ²’æœ‰ class èªæ³•æ™‚ï¼Œå®ƒæ˜¯å¦‚ä½•ä½¿ç”¨ï¼Ÿ**

å¯¦éš›ä¸Šï¼Œå®ƒ new çš„æ±è¥¿åªæ˜¯ä¸€å€‹ functionï¼Œç¨±ç‚ºæ§‹é€ å‡½æ•¸ã€‚
å…¶ä»–ç¨‹å¼èªè¨€ï¼Œæ¯ä¸€å€‹ class åœ¨åˆå§‹åŒ–çš„æ™‚å€™éƒ½æœƒå‘¼å«è£¡é ­çš„ constructorï¼ˆæ§‹é€ å‡½æ•¸ï¼‰ï¼Œå› ç‚ºæ²’æœ‰ class å­˜åœ¨ï¼ŒJavaScript è¨­è¨ˆæ˜¯ä½¿ç”¨ **new é‹ç®—ç¬¦**ç›´æ¥æ¥ä¸€å€‹ function ï¼Œå¯ä»¥ç”Ÿæˆä¸€å€‹å¯¦é«”ï¼Œè€Œé€™å€‹ function å°±æ˜¯æ§‹é€ å‡½æ•¸ï¼Œåƒæ˜¯ä¸€å€‹ä»¿é€ åŸå‹çš„å­˜åœ¨ï¼Œé¡ä¼¼æ–¼æ¨¡æ¿ã€‚

ç„¶è€Œé¡åˆ¥çš„æ ¸å¿ƒå°±æ˜¯æœƒå­˜åœ¨ä¸€äº›å…±æœ‰çš„å±¬æ€§ï¼Œå¦‚æœåªæ˜¯å€‹åˆ¥ç”¨ function ç”Ÿæˆä¸€å€‹å€‹å¯¦ä¾‹ï¼Œä¸¦æ²’æœ‰è¾¦æ³•é”åˆ°å…±äº«ç›®çš„ï¼Œæ‰€ä»¥é€™å€‹æ§‹é€ å‡½æ•¸ä¸¦ä¸æ˜¯æ™®é€šçš„ functionï¼Œä¸€èˆ¬ä¾†èªª function éƒ½å¸¶æœ‰ä¸€å€‹ç‰¹åˆ¥å±¬æ€§å« `prototype`ï¼Œå¤šæ•¸æƒ…æ³æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æ§‹é€ å‡½æ•¸å»ä¸ä¸€æ¨£ï¼Œæˆ‘å€‘æœƒåœ¨æ§‹é€ å‡½æ•¸çš„ function ä¸Šè¨­å®šå®ƒçš„`prototype`ï¼ŒæŠŠè¦å…±äº«çš„å±¬æ€§/æ–¹æ³•å…¨éƒ¨æ”¾å…¥`prototype` è£¡é¢ï¼Œä¸éœ€è¦å…±äº«çš„æ±è¥¿å°±æ”¾åœ¨æ§‹é€ å‡½æ•¸ä¸Šå³å¯ã€‚


ä¸€æ—¦ä½¿ç”¨äº† new ä¾†ç”¢ç”Ÿç‰©ä»¶ï¼Œnew å°±æœƒå¹«å¿™ä½ åƒç…§çš„æ¨¡æ¿ï¼ˆæ§‹é€ å‡½æ•¸ï¼‰è£¡ `prototype` å°è±¡çš„å±¬æ€§/æ–¹æ³•ä¸€ä½µå¼•ç”¨é€²ä¾†ï¼Œç‚ºæ–°ç‰©ä»¶ä¸­è¨­å®šä¸€å€‹ `__proto__` å±¬æ€§ï¼Œå®ƒè£¡é¢çš„å°è±¡æ˜¯å°æ‡‰åˆ°åŸæœ¬æ§‹é€ å‡½æ•¸ä¸­çš„ `prototype` å°è±¡ï¼Œå¯ä»¥èªª `__proto__` å°±æ˜¯æ§‹é€ å‡½æ•¸ `prototype` çš„å¼•ç”¨ã€‚

```javascript=
// ES5 
// ç”¨ new æœ‰äº†ä¸€å€‹ constructor
function Dog(name) {
    this.name = name
}

// å°‡å…±äº«å±¬æ€§ç”¨ prototype å»åŠ ä¸Šæ–¹æ³•
Dog.prototype.getName = function () {
    return this.name
}
Dog.prototype.sayHello = function () {
    console.log(this.name)
}

// 
var d = new Dog('abc')
d.sayHello()

var b = new Dog('hahaha')
b.sayHello()

console.log(d.sayHello() === b.sayHello())  // trueï¼Œå¯¦ä½œæˆåŠŸï¼
```

è€Œ `dog.__proto__` å°è±¡æ˜¯æ ¹æ“š Dog çš„åŸå‹å°è±¡ï¼ˆDog.prototypeï¼‰ï¼Œè€Œ Dog çš„åŸå‹å°è±¡åˆæ˜¯å¼•ç”¨è‡ª Objectï¼Œé€™æ¨£ä¸€è·¯å¼•ç”¨å°±æ§‹æˆäº†åŸå‹éˆï¼Œé¡ä¼¼ç¹¼æ‰¿é—œä¿‚ï¼Œå¯ä»¥å‘¼å«åˆ°è‡ªå·±ä¸Šå±¤ç‰©ä»¶çš„æ–¹æ³•æˆ–å±¬æ€§ã€‚

```javascript=
var dog = new Dog('aaa')
console.log(dog.__proto__ === Dog.prototype) // trueï¼Œä½¿ç”¨ new å·²ç¶“å¹«ä½ è¨­å®šå¥½
```
æ‰€ä»¥ï¼Œèª¿ç”¨ dog.sayHello æ™‚ï¼Œå¦‚æœç™¼ç¾ dog è£¡é¢æ²’æœ‰é€™å€‹å±¬æ€§/æ–¹æ³•ï¼Œå°±æœƒæ²¿è‘—åŸå‹éˆä¸€è·¯å‘ä¸ŠæŸ¥æ‰¾ï¼Œæ‰¾é€™å€‹ `__proto__` æ‰€æŒ‡å‘çš„ prototypeï¼ˆDog.prototypeï¼‰ï¼Œçœ‹çœ‹å®ƒæœ‰æ²’æœ‰ sayHello æ–¹æ³•ï¼Œå¦‚æœæœ‰å°±ä½¿ç”¨ï¼Œæ²’æœ‰å†ç¹¼çºŒæ‰¾ï¼Œä¸€ç›´æ‰¾åˆ° Object é‚„æ˜¯æ²’æœ‰é€™å€‹æ–¹æ³•å°±æœƒå›å‚³ nullï¼Œå› ç‚º Object çš„ prototype å°±æ˜¯æœ€åŸå§‹çš„ prototypeï¼Œæ²’æœ‰æ›´ä¸Šå±¤çš„å¼•ç”¨ã€‚


##### Q: å¦‚ä½•ç¢ºèªï¼Œæ˜¯ç‰©ä»¶è‡ªå·±æœ¬èº«çš„æ–¹æ³•é‚„æ˜¯å‘ä¸Šå¼•ç”¨ï¼Ÿ
Object.prototype æœ‰å€‹æ–¹æ³•æ˜¯ `hasOwnProperty`ï¼Œåœ¨ä¸‹å±¤ç‰©ä»¶è¦ç¢ºèªå±¬æ€§æ™‚å¯ä»¥èª¿ç”¨å®ƒã€‚
```javascript=
a.hasOwnProperty('name'); // true
a.hasOwnProperty('gender'); // true
a.hasOwnProperty('country'); // falseï¼Œcountry å±¬æ€§ä¸æ˜¯ a è‡ªå·±çš„å±¬æ€§
```

##### Q: æ¯”è¼ƒå¥½çš„æ–¹å¼æ˜¯ç”¨ `Object.getPrototypeOf()` æ–¹æ³•ï¼Œä¸æ˜¯ `__proto__`ï¼Ÿ
`__proto__` å±¬æ€§æ˜¯è¨ªå•æ€§å±¬æ€§ï¼Œå®ƒå¯ä»¥æ‹œè¨ªç‰©ä»¶çš„ `[[Prototype]]` çš„å€¼ï¼Œä¸éæ­£ç¢ºæ‡‰è©²ä½¿ç”¨ Object çš„å…§å»ºæ–¹æ³• `getPrototypeOf()`ï¼Œå®ƒæœƒå›å‚³æŒ‡å®šç‰©ä»¶çš„åŸå‹ï¼ŒåŒæ¨£ä¹Ÿæ˜¯å–å¾—è©²ç‰©ä»¶çš„ [[Prototype]] å±¬æ€§å€¼ã€‚



### é‚£éº¼ï¼Œnew åˆ°åº•åšäº†ä»€éº¼ï¼Ÿ

åœ¨è«‡é€™å€‹ä¹‹å‰ï¼Œå…ˆèªè­˜ä¸€ä¸‹ callã€apply å’Œ bind é€™å¹¾å€‹æ–¹æ³•ï¼Œ

ç”¨ call() å‚³å…¥ä»€éº¼ï¼Œå°±æœƒæ”¹åˆ° thisï¼Œç”¨å®ƒä¾†åšå»ºæ§‹å­è¦åšçš„äº‹æƒ…
```javascript=
function test() {
    console.log(this)  // [string: '123']
}
test.call('123')
```

**new å…¶å¯¦æ˜¯å¹«ä½ åšäº†ä»¥ä¸‹å¹¾æ­¥ï¼š**
1. å¹«ä½ ç”¢ç”Ÿä¸€å€‹ object
2. call constructor æŠŠ object ç•¶ä½œ list ä¸Ÿé€²å»
3. å¹«ä½ è¨­å®š `__proto__`
4. å›å‚³ object

æŠŠ `__proto__` æŒ‡åˆ°å€‹åˆ¥çš„ prototypeï¼Œä½¿ç‰©ä»¶å¯¦ä¾‹å¯ä»¥ä½¿ç”¨ prototype ä¸­å·²ç¶“å®šç¾©å¥½çš„å±¬æ€§ã€å‡½å¼ã€‚
```javascript=
function Person(name, age) {
  this.name = name;
  this.age = age;
}

Person.prototype.log = function () {
  console.log(this.name + ', age:' + this.age);
}

// å¯¦ä½œ new åŠŸèƒ½
function newObj(Constructor, arguments) {
  var o = new Object();

  // è®“ o ç¹¼æ‰¿åŸå‹éŠ
  o.__proto__ = Constructor.prototype;

  // åŸ·è¡Œå»ºæ§‹å‡½å¼
  Constructor.call(o, arguments);

  // å›å‚³å»ºç«‹å¥½çš„ç‰©ä»¶
  return o;
}

var nick = newObj(Person, ['nick', 18]);
nick.log(); // nick, age:18
```

#### ç¹¼æ‰¿ï¼šç•¶éœ€è¦ç”¨åˆ°ä¸€äº›å…±åŒå±¬æ€§æ™‚
```javascript=
class BlackDog extends Dog {  // æ²’æœ‰å¯« constructorï¼Œå»æ‰¾ parent çš„å»ºæ§‹å­
    test() {
        console.log(this.name)
    }
}

class BlackDog extends Dog {
    constructor(name) {  // å› ç‚ºè¦†å¯«ï¼Œæ‰€ä»¥ Dog å»ºæ§‹å­ name ä¹Ÿè¦å‚³é€²å»
        super(name)      // call ä¸Šä¸€å±¤çš„ constructor
        this.sayHello()  // å°æ–¼åˆå§‹åŒ–å‰å°±è¦ç”¨åˆ°ç¹¼æ‰¿çš„æ±è¥¿ï¼Œä½¿ç”¨ super()
    }

    test() {
        console.log(this.name)
    }
}
```

---
### this
#### 1. ç‰©ä»¶å°å‘
åœ¨ç‰©ä»¶å°å‘è£¡é¢ï¼Œå¦‚æœæ˜¯å±¬æ–¼æŸç‰©ä»¶ï¼ˆobjectï¼‰çš„æ–¹æ³•/å±¬æ€§ï¼Œthis æ˜¯å®ƒå³å°‡å°æ‡‰åˆ°çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯ç”¨ this ä¾†æŒ‡ç‰©ä»¶æœ¬èº«ã€‚
```javascript=
class Car {
  setName(name) {
    this.name = name
  }
}
  
const myCar = new Car()
myCar.setName('hello')
```

#### 2. éç‰©ä»¶å°å‘
åœ¨è«‡ scope chain æ™‚æœ‰æéï¼Œç¨‹å¼ç¢¼é‹è¡Œå‰çš„ Runtimeï¼ˆè¨˜æ†¶é«”å †ç–Šã€é»˜èªåŸ·è¡Œç’°å¢ƒã€åŸ·è¡Œç’°å¢ƒå †ç–Šï¼‰æœƒè¢«å»ºç«‹ï¼Œé»˜èªåŸ·è¡Œç’°å¢ƒä¹Ÿå°±æ˜¯å…¨åŸŸåŸ·è¡Œç’°å¢ƒ Global Execution Contextï¼Œå®ƒè£¡é¢å­˜æ”¾è‘—ç’°å¢ƒä¸­æœƒéœ€è¦ç”¨åˆ°çš„å„ç¨®è³‡æºã€‚
```javascript=
globalEC = {
  Phase: 'Execution',
  GlobalObject: window,    // åœ¨ç€è¦½å™¨ä¸­ï¼Œå…¨åŸŸç‰©ä»¶ä¾¿æ˜¯æŒ‡ Web API
  this: window,            // åœ¨ç€è¦½å™¨ä¸­ï¼Œthis æ‰€æŒ‡å‘çš„ä¾¿æ˜¯ç€è¦½å™¨ç‰©ä»¶ window
  VO: {                    // Variable Object
    a: 1,
    b: 2,
  }
  scopeChain: globalEC.VO  // å› ç‚ºå·²ç¶“æ˜¯æœ€å¤–å±¤
}
```
è€Œå…¶ä¸­ï¼Œå°±æœ‰é€™éº¼ä¸€å€‹ã€Œthisã€å­˜åœ¨ï¼Œå¦‚æœåœ¨å…¨åŸŸä½¿ç”¨åˆ° this å°±æœƒæ‰¾åˆ°ä¸€å€‹å…¨åŸŸ this è®Šæ•¸ï¼Œæ ¹æ“šç’°å¢ƒçš„ä¸åŒè€Œæ”¹è®Šé è¨­å€¼ï¼Œåœ¨ node.js æŒ‡çš„æ˜¯ä¸€å€‹å« global è®Šæ•¸ï¼Œè€Œåœ¨ç€è¦½å™¨æœƒæŒ‡å‘ä¸€å€‹ window ç‰©ä»¶ï¼Œé™¤éé–‹å•Ÿåš´æ ¼æ¨¡å¼ `'use strict'`ï¼Œé‚£å°±å°±æœƒæ˜¯ undefinedã€‚

è€Œä¸€èˆ¬çš„ functionï¼ˆéæ§‹é€ å‡½æ•¸ï¼‰ï¼Œthis ä¹Ÿæœƒæ˜¯é è¨­å€¼ï¼Œå®ƒå’Œ function æœ¬èº«ä¸¦æ²’æœ‰é—œè¯ã€‚

#### 3. DOM çš„ this
å¦‚æœæ˜¯é€éç€è¦½å™¨ DOM æä¾›çš„ APIsï¼Œä¾‹å¦‚ addEventListener() ä¾†å°ç¯€é»åšå­˜å–æˆ–æ“ä½œï¼Œå®ƒå°æ‡‰çš„ this å°±æœƒæ˜¯ç€è¦½å™¨é»æ“Šäº‹ä»¶çš„ä¸»é«”ï¼Œæ˜¯è§¸ç™¼äº‹ä»¶çš„å…ƒç´ ã€‚
```javascript=
var lbl = document.querySelector('.lbl');

lbl.addEventListener('click', function (e) {
  console.log(this.tagName);      // "label"
}, false);
```

### ğŸ’¡ æ”¹è®Š thisï¼šcallã€apply å’Œ bind æ–¹æ³•
applyã€bindã€callï¼Œæ˜¯ `Function.prototype` ä¸­çš„ä¸‰å€‹å‡½å¼ï¼Œä»–å€‘å¯ä»¥å‹•æ…‹æ”¹è®Šå‡½æ•¸çš„ this
* callã€apply çš†æ˜¯å›å‚³ function åŸ·è¡Œçµæœ
* bind æ–¹æ³•å›å‚³çš„æ˜¯ç¶å®š this å¾Œçš„åŸå‡½æ•¸

#### bind
é€é bind()ï¼Œå¯ä»¥å¼·åˆ¶ç¶å®š this çš„å€¼ï¼Œå› ç‚ºæ˜¯å›å‚³ä¸€å€‹ function è€ŒéåŸ·è¡Œã€‚é€šéå€Ÿç”¨å·²å»ºç«‹çš„å‡½å¼ä¾†å‰µé€ æ–°çš„å‡½å¼ï¼Œå°‡ this ç¶åˆ°æŒ‡å®šçš„ç‰©ä»¶ä¸Š
```javascript=
var name = 'foo'
function logName(){
  console.log(this.name)
}
var tmp = {
  name: 'bar'
}
var newFunction = logName.bind(tmp)
logName()     // foo
newFunction() // bar
```
æ¯”è¼ƒå°‘ä½¿ç”¨åˆ°çš„æ˜¯ï¼Œbind é‚„å¯ä»¥ç¶å®šå‚³å…¥å‡½å¼çš„åƒæ•¸ï¼Œbind() æ¥å—çš„ç¬¬ä¸€ä½åƒæ•¸ç‚ºæŒ‡å®šçš„ thisï¼Œå…¶é¤˜åƒæ•¸å‰‡ä¾åºå‚³çµ¦è¢«ç¶å®šçš„å‡½å¼ï¼Œä½œç‚ºå›ºå®šçš„åƒæ•¸ï¼Œæœ€å¾Œæœƒå›å‚³ä¸€å€‹æ–°çš„å‡½å¼ã€‚


#### å…©ç¨®å‘¼å« function çš„æ–¹æ³•ï¼šcall èˆ‡ apply
å®ƒå€‘çš„ç¬¬ä¸€å€‹åƒæ•¸åŒæ¨£æ˜¯**æ”¹è®Š this çš„å€¼**ï¼Œå…©è€…ç”¨é€”å¹¾ä¹ä¸€æ¨£ï¼Œåƒ…æ¥å—çš„åƒæ•¸é¡å‹ä¸åŒï¼Œapply æ¥çºŒå‚³å…¥çš„åƒæ•¸æœƒç”¨é™£åˆ—ã€‚

ç”¨ call() å‚³å…¥ä»€éº¼ï¼Œå°±æœƒæ”¹åˆ° thisï¼Œç”¨å®ƒä¾†åšå»ºæ§‹å­è¦åšçš„äº‹æƒ…
```javascript=
function test() {
    console.log(this)  // [string: '123']
}
test.call('123')
```

```javascript=
function test(a, b, c) {
    console.log(this)  // [Number: 123]
}

test.call(123, 1, 2, 3)
test.apply(123, [1, 2, 3])
```

### å‘¼å«çš„æ–¹å¼
ä¸€èˆ¬èªç‚ºå‘¼å« JS å‡½æ•¸æœ‰ä»¥ä¸‹å¹¾ç¨®å½¢å¼ï¼Œä¸éå¯¦éš›ä¸Šå‰å…©ç¨®åªæ˜¯é€éä¸€äº›æ–¹å¼è½‰æ›æˆç¬¬ä¸‰ç¨®ï¼Œç¬¬ä¸‰ç¨®æ‰æ˜¯æ­£å¸¸çš„èª¿ç”¨æ–¹æ³•
```javascript=
func(p1, p2) 
obj.child.method(p1, p2)
func.call(context, p1, p2) // å…ˆä¸è«‡ applyï¼Œå…©è€…å°±å·®ä¸å¤š
```
æ‰€ä»¥å…¶å¯¦å¯ä»¥çœ‹æˆ
```javascript=
func(p1, p2)
===> func.call(undefined, p1, p2)

obj.child.method(p1, p2)
===> obj.child.method.call(obj.child, p1, p2)
```

##### thisï¼Œå°±æ˜¯å‡½å¼å‰é¢çš„ context
JS é–‹å§‹åŸ·è¡Œä¸€å€‹å‡½æ•¸ï¼Œå®ƒçš„é‹è¡Œç’°å¢ƒå¾åŸä¾†çš„ Global Code è®Šç‚º Function Codeï¼Œæœƒå‰µå»ºä¸€å€‹ execution context å°è±¡ï¼Œthis å°±æ˜¯ä½ å‘¼å«ä¸€å€‹å‡½å¼æ™‚å‚³çš„ contextã€‚

ç¬¬ä¸€ç¨®èª¿ç”¨æ–¹å¼ï¼Œä¸€æ—¦çœ‹æˆ `func.call()` å°±çŸ¥é“å®ƒæ²’æœ‰å‚³ä»»ä½• context é€²ä¾†ï¼Œç†æ‰€ç•¶ç„¶æ˜¯ unfinedï¼Œä¸éå¦‚æœ this æ˜¯ null æˆ– undefined å°±æœƒå»å…¨åŸŸé»˜èªçš„ this è®Šæ•¸ã€‚

è€Œç”¨ apply()ã€call()ã€bing() ç­‰æ–¹æ³•å‚³çš„ç¬¬ä¸€å€‹åƒæ•¸ï¼Œæ˜¯å¯ä»¥å‹•æ…‹æ”¹è®Š this çš„å€¼ã€‚

### ğŸ’¡ ç‰¹ä¾‹ï¼ç®­é ­å‡½æ•¸ Arrow functions
åœ¨ç‰©ä»¶ä½¿ç”¨å›èª¿æ™‚ï¼Œå¯ä»¥æ‹¿åˆ°æ­£ç¢ºçš„ this

* å‚³çµ±å‡½å¼ï¼šthis ä¾å‘¼å«çš„æ–¹æ³•è€Œå®š
* ç®­é ­å‡½å¼ï¼šthis æ˜¯ä¾æ“šç¶å®šåˆ°å…¶å®šç¾©æ™‚æ‰€åœ¨çš„ç‰©ä»¶

å¤šæ•¸æ™‚å€™ä¸€èˆ¬å‡½æ•¸å·®ä¸å¤šï¼Œæœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ã€Œå®ƒçš„ this å®Œå…¨æ ¹æ“šç¨‹å¼ç¢¼å®šç¾©çš„ä½ç½®ã€ï¼Œä¹Ÿå°±æ˜¯èªªåœ¨ arrow è£¡é¢çš„ this æ°¸é éƒ½æ˜¯èªæ„ä¸Šçš„ this ï¼Œä¸ç®¡æ˜¯èª°å‘¼å«ä»–ï¼Œæˆ–æ˜¯è¢«å¦‚ä½• bindã€callã€applyï¼Œä»–æ°¸é éƒ½æ˜¯æ‹¿åˆ°åŸå…ˆä½œç”¨åŸŸçš„ this ã€‚


### å°çµ
* å¦‚æœæ˜¯ç‰©ä»¶æˆ–é¡åˆ¥çš„è©±ï¼Œthis å°±æœƒæ˜¯å®ƒæœ¬èº«
* this è·Ÿå®ƒå¦‚ä½•è¢«å‘¼å«æœ‰é—œä¿‚ï¼Œç”¨ä¸åŒæ–¹å¼å‘¼å« this å°±æœƒä¸ä¸€æ¨£
* bind() æ–¹æ³•ï¼Œå¼·åˆ¶ç¶å®š this çš„å€¼ï¼Œæ˜¯å›å‚³ä¸€å€‹ functionï¼Œè€Œä¸åƒ call æˆ– apply æ˜¯ç›´æ¥å‘¼å«é‚£å€‹ funciton
* ç‰¹ä¾‹ï¼šç®­é ­å‡½å¼ï¼Œè·Ÿæ€éº¼å‘¼å«ç„¡é—œï¼Œåè€Œå’Œ scope å¾ˆåƒï¼Œ**è·Ÿç¨‹å¼ç¢¼å®šç¾©æœ‰é—œ**


### åƒè€ƒè³‡æ–™ï¼š
1. [JSåŸºç¤ï¼šPrimitive type v.s Object types](https://medium.com/@jobboy0101/js%E5%9F%BA%E7%A4%8E-primitive-type-v-s-object-types-f88f7c16f225)
2. [JavaScript ï¼šPrimitive Types ç´”å€¼(åŸºæœ¬å‹åˆ¥)ä»‹ç´¹](https://dotblogs.com.tw/susan_code/2017/07/06/162049)
3. [é‹ç®—å¼èˆ‡é‹ç®—å­](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Expressions_and_Operators#%E4%B8%80%E5%85%83%E9%81%8B%E7%AE%97%E5%AD%90)
4. [ä½ æ‡‚ JavaScript å—ï¼Ÿ#4 å‹åˆ¥ï¼ˆTypesï¼‰](https://cythilya.github.io/2018/10/11/types/)
5. [è³‡æ–™é¡å‹(å€¼)](https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part3/datatype.html)
6. [è®Šæ•¸æå‡ï¼ˆHoistingï¼‰èˆ‡æš«æ™‚æ­»å€ï¼ˆTDZï¼‰](https://blog.techbridge.cc/2018/11/10/javascript-hoisting/)
7. [ä¸€æ¬¡ææ‡‚å‰ç«¯é¢è©¦æœ€æ„›å•çš„ applyã€bindã€call](https://medium.com/schaoss-blog/%E4%B8%80%E6%AC%A1%E6%90%9E%E6%87%82%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%A9%A6%E6%9C%80%E6%84%9B%E5%95%8F%E7%9A%84-apply-bind-call-708f57518776)
8. [[JavaScript] å‡½æ•¸åŸå‹æœ€å¯¦ç”¨çš„ 3 å€‹æ–¹æ³• â€” callã€applyã€bind](https://medium.com/@realdennis/javascript-%E8%81%8A%E8%81%8Acall-apply-bind%E7%9A%84%E5%B7%AE%E7%95%B0%E8%88%87%E7%9B%B8%E4%BC%BC%E4%B9%8B%E8%99%95-2f82a4b4dd66)
9. [JavaScript this Keyword é—œéµå­—](https://www.fooish.com/javascript/this.html)
10. [æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚](https://blog.huli.tw/2019/02/23/javascript-what-is-this/)
11. [this çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥š](https://zhuanlan.zhihu.com/p/23804247)
